# Основные компоненты проекта

## Репозитории данных

### Аутентификация и пользователи

* **AuthRepository**:
    - Управляет аутентификацией через Firebase Auth
    - Создает документы профилей пользователей в Firestore (/users/{userId})

* **UserRepository**:
    - Работает с профилями пользователей в Firestore
    - Обрабатывает загрузку/обновление аватаров (Storage → Firestore)
    - Предоставляет Flow с данными пользователя (getUserFlow)

* **UsersRepository**:
    - Получает списки пользователей и информацию о подписках
    - Работает с коллекциями /users и /follows
    - Обеспечивает обновления в реальном времени

### Публикации и контент

* **PostRepository**:
    - Создает документы публикаций (/posts/{postId})
    - Загружает изображения в Firebase Storage
    - Обновляет счетчики публикаций пользователей
    - Управляет хэштегами через HashtagRepository
    - Получает метрики публикаций

* **FeedRepository**:
    - Формирует ленту публикаций на основе подписок
    - Использует whereIn-запросы к коллекции /posts

* **CommentsRepository**:
    - Управляет комментариями (/comments/{commentId})
    - Атомарно обновляет счетчики комментариев

### Взаимодействия

* **LikeRepository**:
    - Обрабатывает лайки к публикациям, комментариям и тренировкам
    - Обновляет документы в /post_likes, /comment_likes, /workout_likes
    - Использует транзакции для атомарных обновлений
    - Хранит кэш лайков в Room (таблица CachedLike)

* **SocialRepository**:
    - Управляет подписками на пользователей
    - Обновляет документы в /follows/{followId}
    - Атомарно изменяет счетчики подписчиков

## Структура данных

### Облачная база (Firebase)

* **Firestore коллекции**:
    - /users/{userId} - профили пользователей
    - /posts/{postId} - публикации
    - /comments/{commentId} - комментарии
    - /hashtags/{tag} - хэштеги
    - /post_likes, /comment_likes, /workout_likes - лайки
    - /workout_saves - сохраненные тренировки
    - /follows - подписки
    - /workouts - тренировки

* **Firebase Storage**:
    - user_images/ - аватары
    - posts_collection/{userId}/ - изображения публикаций
    - workout_cover_images/ - обложки тренировок

### Локальная база (Room)

* **Таблицы**:
    - Exercise - упражнения
    - BodyPart - группы мышц
    - Equipment - оборудование
    - TargetMuscle - целевые мышцы
    - CachedLike - кэш лайков
    - WorkoutEntity - сохраненные тренировки

## Ключевые процессы

1. **Первоначальная загрузка упражнений**:
    - Пакетное получение данных из API
    - Обработка и сохранение изображений
    - Кэширование в Room
    - Отметка о завершении в SharedPreferences

2. **Аутентификация**:
    - Регистрация/вход через Firebase Auth
    - Создание профиля в Firestore

3. **Оптимистичные обновления**:
    - Мгновенное обновление UI через Room
    - Фоновая синхронизация с Firestore
    - Повторная отправка при ошибках

4. **Атомарные операции**:
    - Пакетные обновления нескольких документов
    - Транзакции для согласованности данных

5. **Работа с медиа**:
    - Загрузка файлов в Storage
    - Сохранение ссылок в Firestore
    - Обновление UI после завершения

6. **Оффлайн-режим**:
    - Локальное кэширование упражнений
    - Сохранение тренировок
    - Отложенная синхронизация действий